<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tesla租赁 | 车队管理系统</title>

    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css" />
    <style>
        :root {
            --apple-bg: #f5f5f7;
            --apple-card-bg: rgba(255, 255, 255, 0.8);
            --apple-text-primary: #1d1d1f;
            --apple-text-secondary: #86868b;
            --apple-blue: #0071e3;
            --apple-blue-hover: #0077ed;
            --apple-border: #d2d2d7;
            --apple-radius: 20px;
            --apple-shadow: 0 8px 30px rgba(0, 0, 0, 0.04);
            --apple-header-bg: rgba(255, 255, 255, 0.7);
        }

        body {
            background-color: var(--apple-bg);
            color: var(--apple-text-primary);
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", Arial, sans-serif;
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        #app {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* --- Header --- */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding: 20px 30px;
            background: var(--apple-header-bg);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border-radius: var(--apple-radius);
            box-shadow: var(--apple-shadow);
            position: sticky;
            top: 20px;
            z-index: 100;
        }

        .logo-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--apple-text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
            letter-spacing: -0.5px;
        }

        .logo-icon {
            font-size: 28px;
            background: linear-gradient(135deg, #000, #333);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* --- Stats Cards --- */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--apple-card-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: var(--apple-radius);
            box-shadow: var(--apple-shadow);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            border: 1px solid rgba(255, 255, 255, 0.4);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.08);
        }

        .stat-card-title {
            color: var(--apple-text-secondary);
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
        }

        .stat-card-value {
            font-size: 36px;
            font-weight: 700;
            color: var(--apple-text-primary);
            letter-spacing: -1px;
        }

        /* --- Element Plus Overrides (Apple Style) --- */

        /* Tabs */
        .el-tabs--border-card {
            background: var(--apple-card-bg) !important;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.4) !important;
            border-radius: var(--apple-radius);
            box-shadow: var(--apple-shadow) !important;
            overflow: hidden;
        }

        .el-tabs--border-card>.el-tabs__header {
            background: rgba(245, 245, 247, 0.3) !important;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05) !important;
        }

        .el-tabs--border-card>.el-tabs__header .el-tabs__item {
            color: var(--apple-text-secondary);
            font-weight: 500;
            border: none !important;
            transition: all 0.3s ease;
            margin: 0 4px;
            border-radius: 8px;
        }

        .el-tabs--border-card>.el-tabs__header .el-tabs__item.is-active {
            color: var(--apple-blue) !important;
            background: rgba(255, 255, 255, 0.8) !important;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .el-tabs--border-card>.el-tabs__header .el-tabs__item:hover {
            color: var(--apple-blue) !important;
            background: rgba(255, 255, 255, 0.5);
        }

        /* Buttons */
        .el-button {
            border-radius: 980px !important;
            font-weight: 500 !important;
            padding: 10px 24px !important;
            border: none !important;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1) !important;
        }

        .el-button--primary {
            background: linear-gradient(180deg, #0071e3 0%, #0077ed 100%) !important;
            box-shadow: 0 4px 12px rgba(0, 113, 227, 0.3);
        }

        /* 提升表格内链接按钮的可读性 */
        .el-button.is-link.el-button--primary {
            color: var(--apple-blue) !important;
            font-weight: 600 !important;
        }

        .el-button.is-link.el-button--primary:hover {
            color: var(--apple-blue-hover) !important;
        }

        .el-button--primary:hover {
            transform: scale(1.02);
            box-shadow: 0 6px 16px rgba(0, 113, 227, 0.4);
        }

        .el-button--default {
            background: rgba(255, 255, 255, 0.8) !important;
            color: var(--apple-text-primary) !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.05) !important;
        }

        .el-button--default:hover {
            background: #fff !important;
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        /* 故障处理操作按钮，统一外观 */
        .fault-action-btn {
            position: relative;
            display: inline-flex !important;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 6px 14px !important;
            border-radius: 999px !important;
            background: #fff !important;
            color: #0071e3 !important;
            border: 1.5px solid #0071e3 !important;
            font-weight: 700 !important;
            box-shadow: 0 0 0 3px rgba(0, 113, 227, 0.12);
            transition: all 0.2s ease;
            text-decoration: none !important;
        }

        .fault-action-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 20px rgba(0, 113, 227, 0.2);
        }

        .fault-action-btn--swap {
            color: #f7b500 !important;
            border-color: #f7b500 !important;
            box-shadow: 0 0 0 3px rgba(247, 181, 0, 0.18);
        }

        .fault-action-btn--swap:hover {
            box-shadow: 0 8px 20px rgba(247, 181, 0, 0.24);
        }

        /* Table */
        .el-table {
            --el-table-header-bg-color: rgba(255, 255, 255, 0.5) !important;
            --el-table-row-hover-bg-color: rgba(0, 113, 227, 0.05) !important;
            --el-table-bg-color: transparent !important;
            --el-table-tr-bg-color: transparent !important;
            background-color: transparent !important;
        }

        .el-table th.el-table__cell {
            background-color: rgba(255, 255, 255, 0.5) !important;
            color: var(--apple-text-secondary);
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05) !important;
        }

        .el-table td.el-table__cell {
            border-bottom: 1px solid rgba(0, 0, 0, 0.05) !important;
        }

        .el-table .cell {
            color: var(--apple-text-primary);
            font-size: 14px;
        }

        /* Tags */
        .el-tag {
            border-radius: 980px;
            border: none !important;
            font-weight: 600;
            padding: 0 12px;
        }

        .el-tag--success {
            background-color: rgba(52, 199, 89, 0.15) !important;
            color: #34c759 !important;
        }

        .el-tag--warning {
            background-color: rgba(255, 149, 0, 0.15) !important;
            color: #ff9500 !important;
        }

        .el-tag--info {
            background-color: rgba(142, 142, 147, 0.15) !important;
            color: #8e8e93 !important;
        }

        /* Dialog */
        .el-dialog {
            border-radius: var(--apple-radius) !important;
            box-shadow: 0 24px 60px rgba(0, 0, 0, 0.2) !important;
            background: rgba(255, 255, 255, 0.95) !important;
            backdrop-filter: blur(20px) !important;
            -webkit-backdrop-filter: blur(20px) !important;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .el-dialog__header {
            margin-right: 0 !important;
            text-align: center;
            padding: 24px 0 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .el-dialog__title {
            font-weight: 700;
            font-size: 20px;
            color: var(--apple-text-primary);
        }

        .el-dialog__footer {
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            padding: 20px 24px 24px;
        }

        /* Inputs */
        .el-input__wrapper {
            border-radius: 12px !important;
            box-shadow: 0 0 0 1px #d2d2d7 inset !important;
            background-color: rgba(255, 255, 255, 0.8) !important;
            transition: all 0.2s ease;
            padding: 4px 12px !important;
        }

        .el-input__wrapper:hover {
            background-color: #fff !important;
        }

        .el-input__wrapper.is-focus {
            box-shadow: 0 0 0 4px rgba(0, 113, 227, 0.2) inset, 0 0 0 1px var(--apple-blue) inset !important;
            background-color: #fff !important;
        }

        .el-form-item__label {
            color: var(--apple-text-secondary) !important;
            font-weight: 500;
        }

        .action-buttons {
            margin-bottom: 24px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 16px;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.2);
        }
    </style>
</head>

<body>

    <div id="app">
        <div class="header">
            <div class="logo-title">
                <span class="logo-icon"></span>
                Tesla车队管理
            </div>
            <div>
                <el-button type="default" @click="currentTab = 'vehicles'">
                    仪表盘
                </el-button>
            </div>
        </div>

        <div class="stats-container" v-if="currentTab === 'vehicles'">
            <div class="stat-card">
                <div class="stat-card-title">可用车辆</div>
                <div class="stat-card-value">{{ vehicleStats.available }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-card-title">已租车辆</div>
                <div class="stat-card-value">{{ vehicleStats.rented }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-card-title">车队总数</div>
                <div class="stat-card-value">{{ vehicleStats.total }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-card-title">系统状态</div>
                <div class="stat-card-value" style="color: #34c759; font-size: 20px;">运行中</div>
            </div>
        </div>

        <el-tabs v-model="currentTab" type="border-card">
            <el-tab-pane label="车辆列表" name="vehicles">
                <div class="action-buttons">
                    <el-button type="primary" @click="openVehicleDialog">添加车辆</el-button>
                    <el-button type="success" @click="generateVehicles">生成10辆随机车</el-button>
                    <el-button @click="refreshVehicles">刷新</el-button>
                    <el-select v-model="vehicleStatusFilter" placeholder="全部状态" style="width: 160px;">
                        <el-option label="全部状态" value=""></el-option>
                        <el-option v-for="status in vehicleStatusOptions" :key="status" :label="status"
                            :value="status"></el-option>
                    </el-select>
                </div>
                <el-table :data="filteredVehicleList" style="width: 100%" v-loading="loading.vehicles">
                    <el-table-column prop="vehicleId" label="ID" width="60"></el-table-column>
                    <el-table-column prop="carModelName" label="车型"></el-table-column>
                    <el-table-column prop="plateNo" label="车牌号"></el-table-column>
                    <el-table-column prop="currentSoc" label="电量(%)"></el-table-column>
                    <el-table-column prop="currentMileage" label="里程(km)"></el-table-column>
                    <el-table-column prop="status" label="状态" align="center">
                        <template #default="scope">
                            <el-tag
                                :type="scope.row.status === '在库' ? 'success' : scope.row.status === '在租' ? 'warning' : 'info'"
                                effect="dark" round>
                                ● {{ scope.row.status }}
                            </el-tag>
                        </template>
                    </el-table-column>
                    <el-table-column label="操作" align="center" width="180">
                        <template #default="scope">
                            <el-button type="primary" size="small"
                                @click="openEditStatusDialog(scope.row)">修改状态</el-button>
                            <el-button link type="danger" size="small"
                                @click="deleteVehicle(scope.row.vehicleId)">删除</el-button>
                        </template>
                    </el-table-column>
                </el-table>
            </el-tab-pane>

            <el-tab-pane label="客户列表" name="customers">
                <div class="action-buttons">
                    <el-button type="primary" @click="openCustomerDialog">添加客户</el-button>
                    <el-button @click="refreshCustomers">刷新</el-button>
                </div>
                <el-table :data="customerList" style="width: 100%" v-loading="loading.customers">
                    <el-table-column prop="customerId" label="ID" width="60"></el-table-column>
                    <el-table-column prop="name" label="姓名"></el-table-column>
                    <el-table-column prop="phone" label="电话"></el-table-column>
                    <el-table-column prop="idCard" label="身份证号"></el-table-column>
                    <el-table-column prop="driverLicense" label="驾照号"></el-table-column>
                    <el-table-column label="操作" align="center" width="100">
                        <template #default="scope">
                            <el-button link type="danger" size="small"
                                @click="deleteCustomer(scope.row.customerId)">删除</el-button>
                        </template>
                    </el-table-column>
                </el-table>
            </el-tab-pane>

            <el-tab-pane label="订单管理" name="orders">
                <div class="action-buttons">
                    <el-button type="primary" @click="openOrderDialog">新建订单</el-button>
                    <el-button @click="refreshOrders">刷新</el-button>
                </div>
                <el-table :data="orderList" style="width: 100%" v-loading="loading.orders">
                    <el-table-column prop="orderId" label="ID" width="60"></el-table-column>
                    <el-table-column label="客户手机号" width="120">
                        <template #default="scope">
                            {{ getCustomerPhone(scope.row.customerId) }}
                        </template>
                    </el-table-column>
                    <el-table-column label="车牌号" width="100">
                        <template #default="scope">
                            {{ getOrderVehiclePlate(scope.row) }}
                        </template>
                    </el-table-column>
                    <el-table-column prop="rentStart" label="起租时间" width="160"></el-table-column>
                    <el-table-column prop="rentEnd" label="还车时间" width="160"></el-table-column>
                    <el-table-column prop="pickupSoc" label="取车电量(%)"></el-table-column>
                    <el-table-column prop="returnSoc" label="还车电量(%)"></el-table-column>
                    <el-table-column prop="status" label="状态" align="center" width="100">
                        <template #default="scope">
                            <el-tag :type="scope.row.status === 'active' ? 'success' : 'info'">
                                {{ scope.row.status }}
                            </el-tag>
                        </template>
                    </el-table-column>
                    <el-table-column label="操作" align="center" width="200">
                        <template #default="scope">
                            <!-- 已支付状态：显示确认取车按钮 -->
                            <el-button v-if="scope.row.status === '已支付'" link type="success" size="small"
                                @click="openPickupDialog(scope.row)">确认取车</el-button>

                            <!-- 待验车状态：显示验车还车按钮 -->
                            <el-button v-if="scope.row.status === '待验车'" link type="warning" size="small"
                                @click="openReturnDialog(scope.row)">验车还车</el-button>

                            <el-button link type="danger" size="small"
                                @click="deleteOrder(scope.row.orderId)">删除</el-button>
                        </template>
                    </el-table-column>
                </el-table>
            </el-tab-pane>

            <el-tab-pane label="故障工单" name="faults">
                <div class="action-buttons">
                    <el-button @click="refreshFaults">刷新</el-button>
                </div>
                <el-table :data="faultList" style="width: 100%" v-loading="loading.faults">
                    <el-table-column prop="ticketId" label="工单ID" width="90"></el-table-column>
                    <el-table-column prop="orderId" label="订单ID" width="90"></el-table-column>
                    <el-table-column label="车牌号" width="120">
                        <template #default="scope">
                            {{ getVehiclePlate(scope.row.vehicleId) }}
                        </template>
                    </el-table-column>
                    <el-table-column prop="status" label="状态" width="100" align="center">
                        <template #default="scope">
                            <el-tag :type="scope.row.status === '待解决' ? 'warning' : 'success'">
                                {{ scope.row.status }}
                            </el-tag>
                        </template>
                    </el-table-column>
                    <el-table-column prop="resolutionType" label="处理方式" width="120"></el-table-column>
                    <el-table-column prop="description" label="描述"></el-table-column>
                    <el-table-column prop="reportedTime" label="报障时间" width="160"></el-table-column>
                    <el-table-column prop="handledBy" label="处理人" width="120"></el-table-column>
                    <el-table-column label="操作" width="200" align="center">
                        <template #default="scope">
                            <el-button v-if="scope.row.status === '待解决'" link type="primary" size="small"
                                class="fault-action-btn"
                                @click="openFaultResolveDialog(scope.row, '现场维修')">现场维修</el-button>
                            <el-button v-if="scope.row.status === '待解决'" link type="warning" size="small"
                                class="fault-action-btn fault-action-btn--swap"
                                @click="openFaultResolveDialog(scope.row, '更换车辆')">更换车辆</el-button>
                            <span v-else style="color: #67c23a;">已解决</span>
                        </template>
                    </el-table-column>
                </el-table>
            </el-tab-pane>


        </el-tabs>

        <el-dialog v-model="dialogVisible.vehicle" title="新增车辆" width="500px">
            <el-form :model="form.vehicle" label-position="top">
                <el-form-item label="车型">
                    <el-select v-model="form.vehicle.modelId" placeholder="请选择车型" style="width: 100%">
                        <el-option v-for="model in carModels" :key="model.modelId" :label="model.name"
                            :value="model.modelId"></el-option>
                    </el-select>
                </el-form-item>
                <el-form-item label="车牌号">
                    <el-input v-model="form.vehicle.plateNo" placeholder="例如：京A 88888"></el-input>
                </el-form-item>
                <el-form-item label="当前电量(%)">
                    <el-input-number v-model="form.vehicle.currentSoc" :min="0" :max="100" :step="5"
                        style="width: 100%"></el-input-number>
                </el-form-item>
                <el-form-item label="当前里程(km)">
                    <el-input-number v-model="form.vehicle.currentMileage" :min="0" :step="10"
                        style="width: 100%"></el-input-number>
                </el-form-item>
                <el-form-item label="状态">
                    <el-select v-model="form.vehicle.status" style="width: 100%">
                        <el-option label="在库" value="在库"></el-option>
                        <el-option label="在租" value="在租"></el-option>
                        <el-option label="维保" value="维保"></el-option>
                    </el-select>
                </el-form-item>
            </el-form>
            <template #footer>
                <el-button @click="dialogVisible.vehicle = false">取消</el-button>
                <el-button type="primary" @click="submitVehicle" :loading="submitting.vehicle">保存车辆</el-button>
            </template>
        </el-dialog>

        <el-dialog v-model="dialogVisible.customer" title="新增客户" width="500px">
            <el-form :model="form.customer" label-position="top">
                <el-form-item label="姓名">
                    <el-input v-model="form.customer.name" placeholder="张三"></el-input>
                </el-form-item>
                <el-form-item label="电话号码">
                    <el-input v-model="form.customer.phone" placeholder="138 0000 0000"></el-input>
                </el-form-item>
                <el-form-item label="身份证号">
                    <el-input v-model="form.customer.idCard" placeholder="身份证件号码"></el-input>
                </el-form-item>
                <el-form-item label="驾照号">
                    <el-input v-model="form.customer.driverLicense" placeholder="驾照号码"></el-input>
                </el-form-item>
            </el-form>
            <template #footer>
                <el-button @click="dialogVisible.customer = false">取消</el-button>
                <el-button type="primary" @click="submitCustomer" :loading="submitting.customer">保存客户</el-button>
            </template>
        </el-dialog>

        <el-dialog v-model="dialogVisible.order" title="创建订单" width="500px">
            <el-form :model="form.order" label-position="top">
                <el-form-item label="客户 ID">
                    <el-input-number v-model="form.order.customerId" style="width: 100%"></el-input-number>
                </el-form-item>
                <el-form-item label="车辆 ID">
                    <el-input-number v-model="form.order.vehicleId" style="width: 100%"></el-input-number>
                </el-form-item>
                <el-form-item label="起租时间">
                    <el-input v-model="form.order.rentStart" type="datetime-local"></el-input>
                </el-form-item>
                <el-form-item label="还车时间">
                    <el-input v-model="form.order.rentEnd" type="datetime-local"></el-input>
                </el-form-item>
                <el-form-item label="取车门店 ID">
                    <el-input-number v-model="form.order.pickupStoreId" style="width: 100%"></el-input-number>
                </el-form-item>
                <el-form-item label="还车门店 ID">
                    <el-input-number v-model="form.order.returnStoreId" style="width: 100%"></el-input-number>
                </el-form-item>
                <el-form-item label="订单总额">
                    <el-input-number v-model="form.order.totalAmount" :min="0" :step="100"
                        style="width: 100%"></el-input-number>
                </el-form-item>
            </el-form>
            <template #footer>
                <el-button @click="dialogVisible.order = false">取消</el-button>
                <el-button type="primary" @click="submitOrder" :loading="submitting.order">提交订单</el-button>
            </template>
        </el-dialog>

        <el-dialog v-model="dialogVisible.payment" title="处理支付" width="500px">
            <el-form :model="form.payment" label-position="top">
                <el-form-item label="订单 ID">
                    <el-input-number v-model="form.payment.orderId" style="width: 100%"></el-input-number>
                </el-form-item>
                <el-form-item label="金额">
                    <el-input-number v-model="form.payment.amount" :min="0" :step="100"
                        style="width: 100%"></el-input-number>
                </el-form-item>
                <el-form-item label="类型">
                    <el-select v-model="form.payment.type" style="width: 100%">
                        <el-option label="押金" value="押金"></el-option>
                        <el-option label="租金" value="租金"></el-option>
                        <el-option label="赔偿" value="赔偿"></el-option>
                    </el-select>
                </el-form-item>
            </el-form>
            <template #footer>
                <el-button @click="dialogVisible.payment = false">取消</el-button>
                <el-button type="primary" @click="submitPayment" :loading="submitting.payment">提交支付</el-button>
            </template>
        </el-dialog>

        <el-dialog v-model="dialogVisible.store" title="添加门店位置" width="500px">
            <el-form :model="form.store" label-position="top">
                <el-form-item label="门店名称">
                    <el-input v-model="form.store.name" placeholder="例如：市中心分店"></el-input>
                </el-form-item>
                <el-form-item label="地址">
                    <el-input v-model="form.store.address" placeholder="例如：xx路xx号"></el-input>
                </el-form-item>
            </el-form>
            <template #footer>
                <el-button @click="dialogVisible.store = false">取消</el-button>
                <el-button type="primary" @click="submitStore" :loading="submitting.store">保存门店</el-button>
            </template>
        </el-dialog>

        <el-dialog v-model="dialogVisible.violation" title="登记违章" width="500px">
            <el-form :model="form.violation" label-position="top">
                <el-form-item label="车辆 ID">
                    <el-input-number v-model="form.violation.vehicleId" style="width: 100%"></el-input-number>
                </el-form-item>
                <el-form-item label="订单 ID">
                    <el-input-number v-model="form.violation.orderId" style="width: 100%"></el-input-number>
                </el-form-item>
                <el-form-item label="违章位置">
                    <el-input v-model="form.violation.location" placeholder="违章发生位置"></el-input>
                </el-form-item>
                <el-form-item label="罚款金额">
                    <el-input-number v-model="form.violation.fineAmount" :min="0" :step="50"
                        style="width: 100%"></el-input-number>
                </el-form-item>
            </el-form>
            <template #footer>
                <el-button @click="dialogVisible.violation = false">取消</el-button>
                <el-button type="primary" @click="submitViolation" :loading="submitting.violation">保存记录</el-button>
            </template>
        </el-dialog>

        <el-dialog v-model="dialogVisible.maintenance" title="登记维护" width="500px">
            <el-form :model="form.maintenance" label-position="top">
                <el-form-item label="车辆 ID">
                    <el-input-number v-model="form.maintenance.vehicleId" style="width: 100%"></el-input-number>
                </el-form-item>
                <el-form-item label="维保类型">
                    <el-input v-model="form.maintenance.type" placeholder="常规保养、维修等"></el-input>
                </el-form-item>
                <el-form-item label="维保日期">
                    <el-input v-model="form.maintenance.maintDate" type="date"></el-input>
                </el-form-item>
                <el-form-item label="描述">
                    <el-input v-model="form.maintenance.description" type="textarea" placeholder="具体维护内容"></el-input>
                </el-form-item>
            </el-form>
            <template #footer>
                <el-button @click="dialogVisible.maintenance = false">取消</el-button>
                <el-button type="primary" @click="submitMaintenance" :loading="submitting.maintenance">保存记录</el-button>
            </template>
        </el-dialog>

        <!-- 修改状态对话框 -->
        <el-dialog v-model="dialogVisible.editStatus" title="修改车辆状态" width="400px">
            <el-form :model="form.editStatus" label-position="top">
                <el-form-item label="车辆ID">
                    <el-input v-model="form.editStatus.vehicleId" disabled></el-input>
                </el-form-item>
                <el-form-item label="状态">
                    <el-select v-model="form.editStatus.status" style="width: 100%">
                        <el-option label="在库" value="在库"></el-option>
                        <el-option label="在租" value="在租"></el-option>
                        <el-option label="维保" value="维保"></el-option>
                    </el-select>
                </el-form-item>
            </el-form>
            <template #footer>
                <el-button @click="dialogVisible.editStatus = false">取消</el-button>
                <el-button type="primary" @click="submitStatusChange" :loading="submitting.editStatus">保存</el-button>
            </template>
        </el-dialog>

        <!-- 确认取车对话框 -->
        <el-dialog v-model="dialogVisible.pickup" title="确认取车" width="500px">
            <el-form :model="form.pickup" label-position="top">
                <el-form-item label="订单 ID">
                    <el-input v-model="form.pickup.orderId" disabled></el-input>
                </el-form-item>
                <el-form-item label="实际取车时间">
                    <el-input v-model="form.pickup.actualPickupTime" type="datetime-local"></el-input>
                </el-form-item>
                <el-form-item label="取车里程 (km)">
                    <el-input-number v-model="form.pickup.pickupMileage" :min="0" style="width: 100%"></el-input-number>
                </el-form-item>
                <el-form-item label="取车电量 (%)">
                    <el-input-number v-model="form.pickup.actualPickupSoc" :min="0" :max="100" :step="0.1"
                        style="width: 100%"></el-input-number>
                </el-form-item>
            </el-form>
            <template #footer>
                <el-button @click="dialogVisible.pickup = false">取消</el-button>
                <el-button type="primary" @click="submitPickup" :loading="submitting.pickup">确认取车</el-button>
            </template>
        </el-dialog>

        <!-- 确认还车对话框 -->
        <el-dialog v-model="dialogVisible.returnConfirm" title="验车还车" width="500px">
            <el-form :model="form.returnConfirm" label-position="top">
                <el-form-item label="订单 ID">
                    <el-input v-model="form.returnConfirm.orderId" disabled></el-input>
                </el-form-item>
                <el-form-item label="取车记录">
                    <div style="padding: 10px; background: #f5f5f7; border-radius: 8px; font-size: 13px;">
                        <p>取车里程: {{ form.returnConfirm.pickupMileage || '-' }} km</p>
                        <p>取车电量: {{ form.returnConfirm.pickupSoc || '-' }} %</p>
                    </div>
                </el-form-item>
                <el-form-item label="实际还车时间">
                    <el-input v-model="form.returnConfirm.actualReturnTime" type="datetime-local"></el-input>
                </el-form-item>
                <el-form-item label="还车里程 (km)">
                    <el-input-number v-model="form.returnConfirm.returnMileage" :min="0"
                        style="width: 100%"></el-input-number>
                </el-form-item>
                <el-form-item label="还车电量 (%)">
                    <el-input-number v-model="form.returnConfirm.actualReturnSoc" :min="0" :max="100" :step="0.1"
                        style="width: 100%"></el-input-number>
                </el-form-item>
            </el-form>
            <template #footer>
                <el-button @click="dialogVisible.returnConfirm = false">取消</el-button>
                <el-button type="primary" @click="submitReturnConfirm"
                    :loading="submitting.returnConfirm">确认还车</el-button>
            </template>
        </el-dialog>

        <!-- 故障工单处理 -->
        <el-dialog v-model="dialogVisible.faultResolve" title="处理故障工单" width="500px">
            <el-form :model="form.faultResolve" label-position="top">
                <el-form-item label="处理方案">
                    <el-radio-group v-model="form.faultResolve.resolutionType">
                        <el-radio label="现场维修">现场维修</el-radio>
                        <el-radio label="更换车辆">更换车辆</el-radio>
                    </el-radio-group>
                </el-form-item>
                <el-form-item label="处理人">
                    <el-input v-model="form.faultResolve.handledBy" placeholder="输入处理人"></el-input>
                </el-form-item>
                <el-form-item v-if="form.faultResolve.resolutionType === '更换车辆'" label="选择在库车辆">
                    <el-select v-model="form.faultResolve.newVehicleId" placeholder="请选择新车" filterable
                        style="width: 100%">
                        <el-option v-for="v in availableStockVehicles" :key="v.vehicleId"
                            :label="`${v.plateNo} (${v.carModelName || '车辆'})`" :value="v.vehicleId"></el-option>
                    </el-select>
                </el-form-item>
                <el-form-item label="备注">
                    <el-input v-model="form.faultResolve.remark" type="textarea" placeholder="维修情况或换车原因"></el-input>
                </el-form-item>
            </el-form>
            <template #footer>
                <el-button @click="dialogVisible.faultResolve = false">取消</el-button>
                <el-button type="primary" @click="submitFaultResolve" :loading="submitting.faultResolve">提交</el-button>
            </template>
        </el-dialog>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>

    <script>
        const { createApp, ref, reactive, computed, onMounted } = Vue;

        const app = createApp({
            setup() {
                const currentTab = ref('vehicles');

                const loading = reactive({
                    vehicles: false,
                    customers: false,
                    orders: false,
                    faults: false,
                    payments: false,
                    stores: false,
                    violations: false,
                    maintenance: false
                });

                // 模拟数据
                const vehicleList = ref([
                    {
                        vehicleId: 1001,
                        carModelName: 'Model 3 后驱',
                        plateNo: '京A 88888',
                        currentSoc: 85,
                        currentMileage: 12000,
                        status: '在库'
                    },
                    {
                        vehicleId: 1002,
                        carModelName: 'Model Y 长续航',
                        plateNo: '沪B 66666',
                        currentSoc: 62,
                        currentMileage: 18000,
                        status: '在租'
                    },
                    {
                        vehicleId: 1003,
                        carModelName: 'Model S Plaid',
                        plateNo: '粤Z 99999',
                        currentSoc: 40,
                        currentMileage: 25000,
                        status: '维保'
                    }
                ]);
                const customerList = ref([]);
                const orderList = ref([]);
                const faultList = ref([]);
                const paymentList = ref([]);
                const storeList = ref([]);
                const violationList = ref([]);
                const maintenanceList = ref([]);
                const carModels = ref([]);
                const vehicleStatusFilter = ref('');
                const vehicleStatusOptions = ['在租', '在库', '维保'];

                const vehicleStats = computed(() => ({
                    available: vehicleList.value.filter(v => v.status === '在库').length,
                    rented: vehicleList.value.filter(v => v.status === '在租').length,
                    total: vehicleList.value.length
                }));
                const filteredVehicleList = computed(() => {
                    if (!vehicleStatusFilter.value) {
                        return vehicleList.value;
                    }
                    return vehicleList.value.filter(v => v.status === vehicleStatusFilter.value);
                });

                const availableStockVehicles = computed(() =>
                    vehicleList.value.filter(v => v.status === '在库'));

                const dialogVisible = reactive({
                    vehicle: false,
                    customer: false,
                    order: false,
                    editStatus: false,
                    pickup: false,
                    returnConfirm: false,
                    faultResolve: false,
                    payment: false,
                    store: false,
                    violation: false,
                    maintenance: false
                });

                const submitting = reactive({
                    vehicle: false,
                    customer: false,
                    order: false,
                    editStatus: false,
                    pickup: false,
                    returnConfirm: false,
                    faultResolve: false,
                    payment: false,
                    store: false,
                    violation: false,
                    maintenance: false
                });

                const form = reactive({
                    vehicle: { plateNo: '', currentSoc: 100, currentMileage: 0, status: '在库', modelId: null, storeId: null },
                    customer: { name: '', phone: '', idCard: '', driverLicense: '' },
                    order: { customerId: null, vehicleId: null, rentStart: '', rentEnd: '', pickupStoreId: null, returnStoreId: null, totalAmount: 0, status: 'active', pickupSoc: 100, returnSoc: 100 },
                    editStatus: { vehicleId: null, status: '在库' },
                    pickup: {
                        orderId: null,
                        actualPickupTime: '',
                        pickupMileage: 0,
                        actualPickupSoc: 100
                    },
                    returnConfirm: {
                        orderId: null,
                        pickupMileage: null,  // 只读，显示用
                        pickupSoc: null,      // 只读，显示用
                        actualReturnTime: '',
                        returnMileage: 0,
                        actualReturnSoc: 50
                    },
                    payment: { orderId: null, amount: 0, type: '押金' },
                    store: { name: '', address: '' },
                    violation: { vehicleId: null, orderId: null, location: '', fineAmount: 0 },
                    maintenance: { vehicleId: null, type: '', maintDate: '', description: '' },
                    faultResolve: {
                        ticketId: null,
                        resolutionType: '现场维修',
                        handledBy: '',
                        remark: '',
                        newVehicleId: null
                    }
                });

                const baseUrl = 'http://localhost:8080/api';

                // --- 车辆管理 ---
                const refreshVehicles = async () => {
                    loading.vehicles = true;
                    try {
                        const response = await axios.get(`${baseUrl}/vehicles`);
                        vehicleList.value = response.data || [];
                    } catch (error) {
                        console.log("后台未连接，使用模拟数据");
                    } finally {
                        loading.vehicles = false;
                    }
                };

                const fetchCarModels = async () => {
                    try {
                        const response = await axios.get(`${baseUrl}/models`);
                        carModels.value = response.data || [];
                    } catch (error) {
                        console.log("无法获取车型数据");
                    }
                };

                const openVehicleDialog = () => {
                    form.vehicle = { plateNo: '', currentSoc: 100, currentMileage: 0, status: '在库', modelId: null, storeId: null };
                    if (carModels.value.length === 0) {
                        fetchCarModels();
                    }
                    dialogVisible.vehicle = true;
                };

                const submitVehicle = async () => {
                    if (!form.vehicle.plateNo || !form.vehicle.modelId) {
                        ElementPlus.ElMessage.warning('请填写所有字段');
                        return;
                    }
                    submitting.vehicle = true;
                    try {
                        await axios.post(`${baseUrl}/vehicles`, form.vehicle);
                        ElementPlus.ElMessage.success('车辆已添加');
                        dialogVisible.vehicle = false;
                        refreshVehicles();
                    } catch (error) {
                        ElementPlus.ElMessage.error('添加车辆失败');
                    } finally {
                        submitting.vehicle = false;
                    }
                };

                const generateVehicles = async () => {
                    try {
                        await axios.post(`${baseUrl}/vehicles/generate?count=10`);
                        ElementPlus.ElMessage.success('成功生成10辆随机车辆');
                        refreshVehicles();
                    } catch (error) {
                        ElementPlus.ElMessage.error('生成车辆失败');
                    }
                };

                const deleteVehicle = async (id) => {
                    ElementPlus.ElMessageBox.confirm('确定删除该车辆吗？', '警告', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        type: 'warning'
                    }).then(async () => {
                        try {
                            await axios.delete(`${baseUrl}/vehicles/${id}`);
                            ElementPlus.ElMessage.success('删除成功');
                            refreshVehicles();
                        } catch (error) {
                            ElementPlus.ElMessage.error('删除失败');
                        }
                    }).catch(() => {
                        ElementPlus.ElMessage.info('已取消删除');
                    });
                };

                // 打开修改状态对话框
                const openEditStatusDialog = (vehicle) => {
                    form.editStatus.vehicleId = vehicle.vehicleId;
                    form.editStatus.status = vehicle.status;
                    dialogVisible.editStatus = true;
                };

                // 提交状态修改
                const submitStatusChange = async () => {
                    submitting.editStatus = true;
                    try {
                        const vehicleId = form.editStatus.vehicleId;
                        const currentVehicle = vehicleList.value.find(v => v.vehicleId === vehicleId);
                        if (currentVehicle) {
                            // 只发送必要的字段，避免发送计算属性和关联对象
                            const updateData = {
                                vehicleId: currentVehicle.vehicleId,
                                plateNo: currentVehicle.plateNo,
                                currentSoc: currentVehicle.currentSoc,
                                currentMileage: currentVehicle.currentMileage,
                                status: form.editStatus.status,  // 使用新的状态值
                                modelId: currentVehicle.modelId,
                                storeId: currentVehicle.storeId
                            };
                            await axios.put(`${baseUrl}/vehicles/${vehicleId}`, updateData);
                            ElementPlus.ElMessage.success('状态修改成功');
                            dialogVisible.editStatus = false;
                            refreshVehicles();
                        }
                    } catch (error) {
                        console.error('修改失败详情:', error);
                        ElementPlus.ElMessage.error('修改失败: ' + (error.response?.data?.message || error.message));
                    } finally {
                        submitting.editStatus = false;
                    }
                };

                // --- 客户管理 ---
                const refreshCustomers = async () => {
                    loading.customers = true;
                    try {
                        const response = await axios.get(`${baseUrl}/customers`);
                        customerList.value = response.data || [];
                    } catch (error) { } finally {
                        loading.customers = false;
                    }
                };

                const openCustomerDialog = () => {
                    form.customer = { name: '', phone: '', idCard: '' };
                    dialogVisible.customer = true;
                };

                const submitCustomer = async () => {
                    submitting.customer = true;
                    try {
                        await axios.post(`${baseUrl}/customers`, form.customer);
                        dialogVisible.customer = false;
                        refreshCustomers();
                    } catch (error) { } finally {
                        submitting.customer = false;
                    }
                };

                const deleteCustomer = async (id) => {
                    ElementPlus.ElMessageBox.confirm('确定删除该客户吗？', '警告', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        type: 'warning'
                    }).then(async () => {
                        try {
                            await axios.delete(`${baseUrl}/customers/${id}`);
                            ElementPlus.ElMessage.success('删除成功');
                            refreshCustomers();
                        } catch (error) {
                            ElementPlus.ElMessage.error('删除失败');
                        }
                    }).catch(() => {
                        ElementPlus.ElMessage.info('已取消删除');
                    });
                };

                // --- 订单管理 ---
                const refreshOrders = async () => {
                    loading.orders = true;
                    try {
                        const response = await axios.get(`${baseUrl}/orders`);
                        orderList.value = response.data || [];
                    } catch (error) { } finally {
                        loading.orders = false;
                    }
                };

                const openOrderDialog = () => {
                    form.order = { customerId: null, vehicleId: null, rentStart: '', rentEnd: '', pickupStoreId: null, returnStoreId: null, totalAmount: 0, status: 'active', pickupSoc: 100, returnSoc: 100 };
                    dialogVisible.order = true;
                };

                const submitOrder = async () => {
                    submitting.order = true;
                    try {
                        await axios.post(`${baseUrl}/orders`, form.order);
                        dialogVisible.order = false;
                        refreshOrders();
                    } catch (error) { } finally {
                        submitting.order = false;
                    }
                };

                const deleteOrder = async (id) => {
                    ElementPlus.ElMessageBox.confirm('确定删除该订单吗？', '警告', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        type: 'warning'
                    }).then(async () => {
                        try {
                            await axios.delete(`${baseUrl}/orders/${id}`);
                            ElementPlus.ElMessage.success('删除成功');
                            refreshOrders();
                        } catch (error) {
                            ElementPlus.ElMessage.error('删除失败');
                        }
                    }).catch(() => {
                        ElementPlus.ElMessage.info('已取消删除');
                    });
                };

                // 打开取车确认对话框
                const openPickupDialog = (order) => {
                    form.pickup = {
                        orderId: order.orderId,
                        actualPickupTime: new Date().toISOString().slice(0, 16),  // 默认当前时间
                        pickupMileage: 0,
                        actualPickupSoc: 100
                    };
                    dialogVisible.pickup = true;
                };

                // 提交取车确认
                const submitPickup = async () => {
                    if (!form.pickup.actualPickupTime || !form.pickup.pickupMileage) {
                        ElementPlus.ElMessage.warning('请填写所有必填字段');
                        return;
                    }

                    submitting.pickup = true;
                    try {
                        const payload = {
                            actualPickupTime: form.pickup.actualPickupTime.replace('T', ' ') + ':00',
                            pickupMileage: form.pickup.pickupMileage,
                            actualPickupSoc: form.pickup.actualPickupSoc
                        };

                        await axios.put(`${baseUrl}/orders/${form.pickup.orderId}/pickup`, payload);
                        ElementPlus.ElMessage.success('取车确认成功！');
                        dialogVisible.pickup = false;
                        refreshOrders();
                    } catch (error) {
                        ElementPlus.ElMessage.error('取车确认失败: ' + (error.response?.data?.message || error.message));
                    } finally {
                        submitting.pickup = false;
                    }
                };

                // 打开还车确认对话框
                const openReturnDialog = (order) => {
                    form.returnConfirm = {
                        orderId: order.orderId,
                        pickupMileage: order.pickupMileage,  // 显示取车时的里程
                        pickupSoc: order.actualPickupSoc,     // 显示取车时的电量
                        actualReturnTime: new Date().toISOString().slice(0, 16),
                        returnMileage: order.pickupMileage || 0,  // 默认值不小于取车里程
                        actualReturnSoc: 50
                    };
                    dialogVisible.returnConfirm = true;
                };

                // 提交还车确认
                const submitReturnConfirm = async () => {
                    if (!form.returnConfirm.actualReturnTime || !form.returnConfirm.returnMileage) {
                        ElementPlus.ElMessage.warning('请填写所有必填字段');
                        return;
                    }

                    // 验证还车里程
                    if (form.returnConfirm.returnMileage < form.returnConfirm.pickupMileage) {
                        ElementPlus.ElMessage.warning('还车里程不能小于取车里程');
                        return;
                    }

                    submitting.returnConfirm = true;
                    try {
                        const payload = {
                            actualReturnTime: form.returnConfirm.actualReturnTime.replace('T', ' ') + ':00',
                            returnMileage: form.returnConfirm.returnMileage,
                            actualReturnSoc: form.returnConfirm.actualReturnSoc
                        };

                        await axios.put(`${baseUrl}/orders/${form.returnConfirm.orderId}/confirm-return`, payload);
                        ElementPlus.ElMessage.success('还车确认成功！车辆已上架');
                        dialogVisible.returnConfirm = false;
                        refreshOrders();
                        refreshVehicles();  // 车辆状态已更新，刷新车辆列表
                    } catch (error) {
                        ElementPlus.ElMessage.error('还车确认失败: ' + (error.response?.data?.message || error.message));
                    } finally {
                        submitting.returnConfirm = false;
                    }
                };

                // --- 故障工单 ---
                const refreshFaults = async () => {
                    loading.faults = true;
                    try {
                        const response = await axios.get(`${baseUrl}/faults`);
                        faultList.value = response.data || [];
                    } catch (error) { } finally {
                        loading.faults = false;
                    }
                };

                const openFaultResolveDialog = (ticket, resolutionType) => {
                    form.faultResolve = {
                        ticketId: ticket.ticketId,
                        resolutionType: resolutionType,
                        handledBy: '',
                        remark: '',
                        newVehicleId: null
                    };
                    if (resolutionType === '更换车辆' && vehicleList.value.length === 0) {
                        refreshVehicles();
                    }
                    dialogVisible.faultResolve = true;
                };

                const submitFaultResolve = async () => {
                    if (!form.faultResolve.ticketId) {
                        return;
                    }
                    if (form.faultResolve.resolutionType === '更换车辆' && !form.faultResolve.newVehicleId) {
                        ElementPlus.ElMessage.warning('请选择要替换的车辆');
                        return;
                    }
                    submitting.faultResolve = true;
                    try {
                        const payload = {
                            resolutionType: form.faultResolve.resolutionType,
                            handledBy: form.faultResolve.handledBy,
                            remark: form.faultResolve.remark,
                            newVehicleId: form.faultResolve.resolutionType === '更换车辆'
                                ? form.faultResolve.newVehicleId
                                : null
                        };
                        await axios.put(`${baseUrl}/faults/${form.faultResolve.ticketId}/resolve`, payload);
                        ElementPlus.ElMessage.success('工单处理成功');
                        dialogVisible.faultResolve = false;
                        refreshFaults();
                        refreshOrders();
                        refreshVehicles();
                    } catch (error) {
                        ElementPlus.ElMessage.error('处理失败: ' + (error.response?.data?.message || error.message));
                    } finally {
                        submitting.faultResolve = false;
                    }
                };

                // --- 支付管理 ---
                const refreshPayments = async () => {
                    loading.payments = true;
                    try {
                        const response = await axios.get(`${baseUrl}/payments`);
                        paymentList.value = response.data || [];
                    } catch (error) { } finally {
                        loading.payments = false;
                    }
                };

                const openPaymentDialog = () => {
                    form.payment = { orderId: null, amount: 0, type: '押金' };
                    dialogVisible.payment = true;
                };

                const submitPayment = async () => {
                    submitting.payment = true;
                    try {
                        await axios.post(`${baseUrl}/payments`, form.payment);
                        dialogVisible.payment = false;
                        refreshPayments();
                    } catch (error) { } finally {
                        submitting.payment = false;
                    }
                };

                const deletePayment = async (id) => {
                    ElementPlus.ElMessageBox.confirm('确定删除该支付记录吗？', '警告', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        type: 'warning'
                    }).then(async () => {
                        try {
                            await axios.delete(`${baseUrl}/payments/${id}`);
                            ElementPlus.ElMessage.success('删除成功');
                            refreshPayments();
                        } catch (error) {
                            ElementPlus.ElMessage.error('删除失败');
                        }
                    }).catch(() => {
                        ElementPlus.ElMessage.info('已取消删除');
                    });
                };

                // --- 门店管理 ---
                const refreshStores = async () => {
                    loading.stores = true;
                    try {
                        const response = await axios.get(`${baseUrl}/stores`);
                        storeList.value = response.data || [];
                    } catch (error) { } finally {
                        loading.stores = false;
                    }
                };

                const openStoreDialog = () => {
                    form.store = { name: '', address: '' };
                    dialogVisible.store = true;
                };

                const submitStore = async () => {
                    submitting.store = true;
                    try {
                        await axios.post(`${baseUrl}/stores`, form.store);
                        dialogVisible.store = false;
                        refreshStores();
                    } catch (error) { } finally {
                        submitting.store = false;
                    }
                };

                const deleteStore = async (id) => {
                    ElementPlus.ElMessageBox.confirm('确定删除该门店吗？', '警告', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        type: 'warning'
                    }).then(async () => {
                        try {
                            await axios.delete(`${baseUrl}/stores/${id}`);
                            ElementPlus.ElMessage.success('删除成功');
                            refreshStores();
                        } catch (error) {
                            ElementPlus.ElMessage.error('删除失败');
                        }
                    }).catch(() => {
                        ElementPlus.ElMessage.info('已取消删除');
                    });
                };

                // --- 违章管理 ---
                const refreshViolations = async () => {
                    loading.violations = true;
                    try {
                        const response = await axios.get(`${baseUrl}/violations`);
                        violationList.value = response.data || [];
                    } catch (error) { } finally {
                        loading.violations = false;
                    }
                };

                const openViolationDialog = () => {
                    form.violation = { vehicleId: null, orderId: null, location: '', fineAmount: 0 };
                    dialogVisible.violation = true;
                };

                const submitViolation = async () => {
                    submitting.violation = true;
                    try {
                        await axios.post(`${baseUrl}/violations`, form.violation);
                        dialogVisible.violation = false;
                        refreshViolations();
                    } catch (error) { } finally {
                        submitting.violation = false;
                    }
                };

                const deleteViolation = async (id) => {
                    ElementPlus.ElMessageBox.confirm('确定删除该违章记录吗？', '警告', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        type: 'warning'
                    }).then(async () => {
                        try {
                            await axios.delete(`${baseUrl}/violations/${id}`);
                            ElementPlus.ElMessage.success('删除成功');
                            refreshViolations();
                        } catch (error) {
                            ElementPlus.ElMessage.error('删除失败');
                        }
                    }).catch(() => {
                        ElementPlus.ElMessage.info('已取消删除');
                    });
                };

                // --- 维护管理 ---
                const refreshMaintenance = async () => {
                    loading.maintenance = true;
                    try {
                        const response = await axios.get(`${baseUrl}/maintenance`);
                        maintenanceList.value = response.data || [];
                    } catch (error) { } finally {
                        loading.maintenance = false;
                    }
                };

                const openMaintenanceDialog = () => {
                    form.maintenance = { vehicleId: null, type: '', maintDate: '', description: '' };
                    dialogVisible.maintenance = true;
                };

                const submitMaintenance = async () => {
                    submitting.maintenance = true;
                    try {
                        await axios.post(`${baseUrl}/maintenance`, form.maintenance);
                        dialogVisible.maintenance = false;
                        refreshMaintenance();
                    } catch (error) { } finally {
                        submitting.maintenance = false;
                    }
                };

                const deleteMaintenance = async (id) => {
                    ElementPlus.ElMessageBox.confirm('确定删除该维护保养记录吗？', '警告', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        type: 'warning'
                    }).then(async () => {
                        try {
                            await axios.delete(`${baseUrl}/maintenance/${id}`);
                            ElementPlus.ElMessage.success('删除成功');
                            refreshMaintenance();
                        } catch (error) {
                            ElementPlus.ElMessage.error('删除失败');
                        }
                    }).catch(() => {
                        ElementPlus.ElMessage.info('已取消删除');
                    });
                };

                onMounted(() => {
                    refreshVehicles();
                    refreshCustomers();
                    refreshOrders();
                    refreshFaults();
                });

                // 辅助函数：获取客户手机号
                const getCustomerPhone = (customerId) => {
                    const customer = customerList.value.find(c => c.customerId === customerId);
                    return customer ? customer.phone : customerId; // 如果找不到显示ID
                };

                // 辅助函数：获取车牌号
                const getVehiclePlate = (vehicleId) => {
                    const vehicle = vehicleList.value.find(v => v.vehicleId === vehicleId);
                    return vehicle ? vehicle.plateNo : vehicleId; // 如果找不到显示ID
                };

                // 辅助函数：获取订单当前车牌（优先使用当前用车ID）
                const getOrderVehiclePlate = (order) => {
                    const vehicleId = order.currentVehicleId || order.vehicleId;
                    return getVehiclePlate(vehicleId);
                };

                return {
                    carModels,
                    fetchCarModels,
                    currentTab,
                    loading,
                    vehicleList,
                    vehicleStatusFilter,
                    vehicleStatusOptions,
                    filteredVehicleList,
                    customerList,
                    orderList,
                    vehicleStats,
                    dialogVisible,
                    submitting,
                    form,
                    refreshVehicles,
                    openVehicleDialog,
                    submitVehicle,
                    generateVehicles,
                    deleteVehicle,
                    refreshCustomers,
                    openCustomerDialog,
                    submitCustomer,
                    deleteCustomer,
                    refreshOrders,
                    openOrderDialog,
                    submitOrder,
                    deleteOrder,
                    openPickupDialog,
                    submitPickup,
                    openReturnDialog,
                    submitReturnConfirm,
                    faultList,
                    refreshFaults,
                    openFaultResolveDialog,
                    submitFaultResolve,
                    openEditStatusDialog,
                    submitStatusChange,
                    availableStockVehicles,
                    getCustomerPhone,
                    getVehiclePlate,
                    getOrderVehiclePlate
                };
            }
        });

        app.use(ElementPlus);
        app.mount('#app');
    </script>
</body>

</html>s
