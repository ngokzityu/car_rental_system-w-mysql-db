# Tesla ç§Ÿè½¦ç³»ç»Ÿ - ç§Ÿè½¦é—­ç¯è®¾è®¡æ–¹æ¡ˆ

> **è¯¾ç¨‹è®¾è®¡ç®€åŒ–ç‰ˆæœ¬** - ä¸“æ³¨äºæ ¸å¿ƒä¸šåŠ¡æµç¨‹å’Œæ•°æ®åº“è®¾è®¡

## ğŸ“‹ è®¾è®¡ç›®æ ‡

ä¸ºå¤§å­¦æ•°æ®åº“è¯¾ç¨‹è®¾è®¡å®ç°ä¸€ä¸ªç®€æ´ã€å®Œæ•´çš„ç§Ÿè½¦åˆ°è¿˜è½¦é—­ç¯æµç¨‹ï¼Œé‡ç‚¹å±•ç¤ºï¼š
- æ•°æ®åº“è®¾è®¡èƒ½åŠ›ï¼ˆè¡¨ç»“æ„ã€å¤–é”®ã€çŠ¶æ€ç®¡ç†ï¼‰
- ä¸šåŠ¡é€»è¾‘ç†è§£ï¼ˆè®¢å•çŠ¶æ€æµè½¬ã€è½¦è¾†çŠ¶æ€è”åŠ¨ï¼‰
- å‰åç«¯äº¤äº’ï¼ˆRESTful APIã€å‰ç«¯ç•Œé¢ï¼‰

---

## ğŸ”„ æ ¸å¿ƒä¸šåŠ¡æµç¨‹

### ç®€åŒ–çš„çŠ¶æ€æµè½¬å›¾

```
ç”¨æˆ·ä¸‹å• â†’ [å·²æ”¯ä»˜] â†’ å‘˜å·¥ç¡®è®¤å–è½¦ â†’ [ä½¿ç”¨ä¸­] â†’ ç”¨æˆ·ç”³è¯·è¿˜è½¦ â†’ [å¾…éªŒè½¦] â†’ å‘˜å·¥ç¡®è®¤è¿˜è½¦ â†’ [å·²å®Œæˆ]
    â†“           â†“                â†“                  â†“                   â†“
 åˆ›å»ºè®¢å•    è½¦è¾†é¢„è®¢ä¸­        è½¦è¾†åœ¨ç§Ÿ          ç­‰å¾…éªŒè½¦             è½¦è¾†åœ¨åº“
```

### 4ä¸ªæ ¸å¿ƒçŠ¶æ€

| çŠ¶æ€ | è¯´æ˜ | è§¦å‘äºº | ä¸‹ä¸€æ­¥æ“ä½œ |
|------|------|--------|-----------|
| **å·²æ”¯ä»˜** | ç”¨æˆ·ä¸‹å•æˆåŠŸï¼Œç­‰å¾…å–è½¦ | ç”¨æˆ· | å‘˜å·¥ç¡®è®¤å–è½¦ |
| **ä½¿ç”¨ä¸­** | ç”¨æˆ·å·²å–è½¦ï¼Œæ­£åœ¨ä½¿ç”¨ | å‘˜å·¥ | ç”¨æˆ·ç”³è¯·è¿˜è½¦ |
| **å¾…éªŒè½¦** | ç”¨æˆ·å·²è¿˜è½¦ï¼Œç­‰å¾…å‘˜å·¥éªŒæ”¶ | ç”¨æˆ· | å‘˜å·¥éªŒè½¦ç¡®è®¤ |
| **å·²å®Œæˆ** | è®¢å•å®Œæˆï¼Œè½¦è¾†å¯å†æ¬¡å‡ºç§Ÿ | å‘˜å·¥ | - |

---

## ğŸ“Š æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨ç»“æ„ï¼ˆå·²æœ‰ï¼‰

```sql
-- è®¢å•è¡¨
rental_order (
    order_id,           -- è®¢å•ID
    customer_id,        -- å®¢æˆ·ID
    vehicle_id,         -- è½¦è¾†ID
    rent_start,         -- è®¡åˆ’å–è½¦æ—¶é—´
    rent_end,           -- è®¡åˆ’è¿˜è½¦æ—¶é—´
    pickup_soc,         -- è®¡åˆ’å–è½¦ç”µé‡
    return_soc,         -- è®¡åˆ’è¿˜è½¦ç”µé‡
    total_amount,       -- è®¢å•æ€»é¢
    status              -- è®¢å•çŠ¶æ€
)

-- è½¦è¾†è¡¨
vehicle (
    vehicle_id,         -- è½¦è¾†ID
    plate_no,           -- è½¦ç‰Œå·
    current_soc,        -- å½“å‰ç”µé‡
    current_mileage,    -- å½“å‰é‡Œç¨‹
    status,             -- è½¦è¾†çŠ¶æ€ï¼ˆ0=åœ¨åº“ï¼Œ1=åœ¨ç§Ÿï¼Œ2=ç»´ä¿ï¼‰
    model_id,           -- è½¦å‹ID
    store_id            -- æ‰€å±é—¨åº—ID
)
```

### éœ€è¦æ–°å¢çš„å­—æ®µ

ä¸ºäº†è®°å½•å®é™…å–è¿˜è½¦ä¿¡æ¯ï¼Œéœ€è¦åœ¨ `rental_order` è¡¨ä¸­æ·»åŠ ä»¥ä¸‹å­—æ®µï¼š

```sql
ALTER TABLE rental_order
ADD COLUMN actual_pickup_time DATETIME COMMENT 'å®é™…å–è½¦æ—¶é—´',
ADD COLUMN actual_return_time DATETIME COMMENT 'å®é™…è¿˜è½¦æ—¶é—´',
ADD COLUMN pickup_mileage INT COMMENT 'å–è½¦é‡Œç¨‹',
ADD COLUMN return_mileage INT COMMENT 'è¿˜è½¦é‡Œç¨‹';
```

**è®¾è®¡è¯´æ˜ï¼š**
- ä¸é¢å¤–åˆ›å»º `pickup_record` å’Œ `return_record` è¡¨ï¼ˆè¯¾ç¨‹è®¾è®¡ç®€åŒ–ï¼‰
- æ‰€æœ‰å–è¿˜è½¦ä¿¡æ¯ç›´æ¥è®°å½•åœ¨è®¢å•è¡¨ä¸­
- é€šè¿‡æ—¶é—´æˆ³å­—æ®µåˆ¤æ–­æ“ä½œæ˜¯å¦å®Œæˆ

---

## ğŸ¬ å®Œæ•´é—­ç¯æ¼”ç¤ºæµç¨‹

### Step 1: ç”¨æˆ·ä¸‹å•ï¼ˆç”¨æˆ·ä¾§ï¼‰

**æ“ä½œç•Œé¢ï¼š** `customer.html` - è½¦è¾†æµè§ˆé¡µé¢

**ç”¨æˆ·æ“ä½œï¼š**
1. æµè§ˆå¯ç”¨è½¦è¾†åˆ—è¡¨
2. é€‰æ‹©å¿ƒä»ªè½¦è¾† `Model 3 æ ‡å‡†ç»­èˆªç‰ˆ`
3. ç‚¹å‡»"ç«‹å³é¢„è®¢"æŒ‰é’®
4. å¡«å†™ä¸ªäººä¿¡æ¯ï¼š
   - å§“åï¼šå¼ æ˜å®‡
   - ç”µè¯ï¼š13800001001
   - èº«ä»½è¯å·ï¼š110101200001011234
   - é©¾ç…§å·ï¼šD110101200001011234
   - ç§ŸæœŸï¼š2025-12-10 09:00 è‡³ 2025-12-13 18:00
5. ç‚¹å‡»"ç¡®è®¤é¢„è®¢"

**ç³»ç»Ÿå“åº”ï¼š**
```sql
-- 1. åˆ›å»ºå®¢æˆ·è®°å½•ï¼ˆå¦‚ä¸å­˜åœ¨ï¼‰
INSERT INTO customer (name, phone, id_card, driver_license) 
VALUES ('å¼ æ˜å®‡', '13800001001', '110101200001011234', 'D110101200001011234');

-- 2. åˆ›å»ºè®¢å•
INSERT INTO rental_order (
    customer_id, vehicle_id, rent_start, rent_end,
    pickup_soc, total_amount, status, pickup_store_id, return_store_id
) VALUES (
    1, 1, '2025-12-10 09:00:00', '2025-12-13 18:00:00',
    85.5, 1200.00, 'å·²æ”¯ä»˜', 1, 1
);

-- 3. æ›´æ–°è½¦è¾†çŠ¶æ€
UPDATE vehicle SET status = 1 WHERE vehicle_id = 1;  -- 1=åœ¨ç§Ÿ
```

**æ•°æ®å˜åŒ–ï¼š**
- âœ… è®¢å•çŠ¶æ€ï¼š`å·²æ”¯ä»˜`
- âœ… è½¦è¾†çŠ¶æ€ï¼š`åœ¨ç§Ÿ`ï¼ˆé¢„è®¢ä¸­ï¼‰
- âœ… å‰ç«¯æç¤ºï¼š"é¢„è®¢æˆåŠŸï¼æˆ‘ä»¬ä¼šå°½å¿«è”ç³»æ‚¨ã€‚"

---

### Step 2: å‘˜å·¥ç¡®è®¤å–è½¦ï¼ˆå‘˜å·¥ä¾§ï¼‰

**æ“ä½œç•Œé¢ï¼š** `index.html` - è®¢å•ç®¡ç†é¡µé¢

**å‘˜å·¥æ“ä½œï¼š**
1. ç™»å½•å‘˜å·¥ç®¡ç†ç³»ç»Ÿ
2. åˆ‡æ¢åˆ°"è®¢å•ç®¡ç†"Tabé¡µ
3. æŸ¥çœ‹"å¾…å–è½¦è®¢å•"åˆ—è¡¨ï¼ˆstatus='å·²æ”¯ä»˜'ï¼‰
4. æ‰¾åˆ°è®¢å•ï¼šå¼ æ˜å®‡ - Model 3 - äº¬A12345
5. ç‚¹å‡»"ç¡®è®¤å–è½¦"æŒ‰é’®
6. å¡«å†™å–è½¦ä¿¡æ¯ï¼š
   - å®é™…å–è½¦æ—¶é—´ï¼š2025-12-10 09:15:00
   - å–è½¦é‡Œç¨‹ï¼š15230 km
   - å–è½¦ç”µé‡ï¼š85.5%
   - éªŒè½¦å¤‡æ³¨ï¼šè½¦å†µè‰¯å¥½ï¼Œæ— åˆ’ç—•
7. ç‚¹å‡»"æäº¤"

**ç³»ç»Ÿå“åº”ï¼š**
```sql
-- æ›´æ–°è®¢å•çŠ¶æ€å’Œå–è½¦ä¿¡æ¯
UPDATE rental_order SET
    status = 'ä½¿ç”¨ä¸­',
    actual_pickup_time = '2025-12-10 09:15:00',
    pickup_mileage = 15230,
    pickup_soc = 85.5
WHERE order_id = 1;

-- è½¦è¾†çŠ¶æ€ä¿æŒä¸å˜ï¼ˆå·²ç»æ˜¯"åœ¨ç§Ÿ"ï¼‰
-- ä½†å¯ä»¥æ›´æ–°æœ€åæ“ä½œæ—¶é—´ç­‰ä¿¡æ¯
```

**æ•°æ®å˜åŒ–ï¼š**
- âœ… è®¢å•çŠ¶æ€ï¼š`å·²æ”¯ä»˜` â†’ `ä½¿ç”¨ä¸­`
- âœ… è®°å½•äº†å®é™…å–è½¦æ—¶é—´å’Œåˆå§‹çŠ¶æ€
- âœ… å‰ç«¯æç¤ºï¼š"å–è½¦ç¡®è®¤æˆåŠŸï¼"

---

### Step 3: ç”¨æˆ·ç”³è¯·è¿˜è½¦ï¼ˆç”¨æˆ·ä¾§ï¼‰

**æ“ä½œç•Œé¢ï¼š** `customer.html` - æˆ‘çš„è®¢å•é¡µé¢

**ç”¨æˆ·æ“ä½œï¼š**
1. è¿›å…¥"æˆ‘çš„è®¢å•"é¡µé¢
2. æŸ¥çœ‹å½“å‰è®¢å•çŠ¶æ€ï¼š`ä½¿ç”¨ä¸­`
3. è®¢å•è¯¦æƒ…æ˜¾ç¤ºï¼š
   - è½¦è¾†ï¼šModel 3 æ ‡å‡†ç»­èˆªç‰ˆ (äº¬A12345)
   - å–è½¦æ—¶é—´ï¼š2025-12-10 09:15
   - é¢„è®¡è¿˜è½¦æ—¶é—´ï¼š2025-12-13 18:00
   - å·²ä½¿ç”¨ï¼š3å¤©
4. ç‚¹å‡»"ç”³è¯·è¿˜è½¦"æŒ‰é’®
5. ç¡®è®¤è¿˜è½¦åœ°ç‚¹ï¼šåŒ—äº¬æœé˜³ä½“éªŒä¸­å¿ƒ
6. ç‚¹å‡»"æäº¤è¿˜è½¦ç”³è¯·"

**ç³»ç»Ÿå“åº”ï¼š**
```sql
-- æ›´æ–°è®¢å•çŠ¶æ€
UPDATE rental_order SET
    status = 'å¾…éªŒè½¦'
WHERE order_id = 1;
```

**æ•°æ®å˜åŒ–ï¼š**
- âœ… è®¢å•çŠ¶æ€ï¼š`ä½¿ç”¨ä¸­` â†’ `å¾…éªŒè½¦`
- âœ… è½¦è¾†çŠ¶æ€ï¼šä»ä¸º`åœ¨ç§Ÿ`ï¼ˆç­‰å¾…å‘˜å·¥éªŒè½¦åæ‰é‡Šæ”¾ï¼‰
- âœ… å‰ç«¯æç¤ºï¼š"è¿˜è½¦ç”³è¯·å·²æäº¤ï¼Œè¯·å‰å¾€é—¨åº—éªŒè½¦ï¼"

---

### Step 4: å‘˜å·¥ç¡®è®¤è¿˜è½¦ï¼ˆå‘˜å·¥ä¾§ï¼‰

**æ“ä½œç•Œé¢ï¼š** `index.html` - è®¢å•ç®¡ç†é¡µé¢

**å‘˜å·¥æ“ä½œï¼š**
1. åœ¨"è®¢å•ç®¡ç†"é¡µé¢æŸ¥çœ‹"å¾…éªŒè½¦è®¢å•"åˆ—è¡¨
2. æ‰¾åˆ°è®¢å•ï¼šå¼ æ˜å®‡ - Model 3 - äº¬A12345
3. ç‚¹å‡»"éªŒè½¦è¿˜è½¦"æŒ‰é’®
4. æŸ¥çœ‹å–è½¦æ—¶çš„è®°å½•ï¼š
   - å–è½¦é‡Œç¨‹ï¼š15230 km
   - å–è½¦ç”µé‡ï¼š85.5%
5. å¡«å†™è¿˜è½¦ä¿¡æ¯ï¼š
   - å®é™…è¿˜è½¦æ—¶é—´ï¼š2025-12-13 17:30:00
   - è¿˜è½¦é‡Œç¨‹ï¼š15850 kmï¼ˆè¡Œé©¶äº† 620 kmï¼‰
   - è¿˜è½¦ç”µé‡ï¼š45.2%
   - è½¦å†µæ£€æŸ¥ï¼š
     - â˜‘ å¤–è§‚å®Œå¥½
     - â˜‘ å†…é¥°æ•´æ´
     - â˜‘ æ— å¼‚å¸¸æŸå
   - éªŒè½¦å¤‡æ³¨ï¼šè½¦è¾†çŠ¶æ€è‰¯å¥½
6. ç‚¹å‡»"ç¡®è®¤è¿˜è½¦"

**ç³»ç»Ÿå“åº”ï¼š**
```sql
-- 1. æ›´æ–°è®¢å•çŠ¶æ€å’Œè¿˜è½¦ä¿¡æ¯
UPDATE rental_order SET
    status = 'å·²å®Œæˆ',
    actual_return_time = '2025-12-13 17:30:00',
    return_mileage = 15850,
    return_soc = 45.2
WHERE order_id = 1;

-- 2. é‡Šæ”¾è½¦è¾†ï¼Œæ›´æ–°è½¦è¾†çŠ¶æ€
UPDATE vehicle SET
    status = 0,              -- 0=åœ¨åº“
    current_mileage = 15850, -- æ›´æ–°é‡Œç¨‹
    current_soc = 45.2       -- æ›´æ–°ç”µé‡
WHERE vehicle_id = 1;

-- 3. (å¯é€‰) è®°å½•å®¡è®¡æ—¥å¿—
INSERT INTO audit_log (user_id, action, target_table, target_id, action_time)
VALUES (6, 'ç¡®è®¤è¿˜è½¦', 'rental_order', 1, NOW());
```

**æ•°æ®å˜åŒ–ï¼š**
- âœ… è®¢å•çŠ¶æ€ï¼š`å¾…éªŒè½¦` â†’ `å·²å®Œæˆ`
- âœ… è½¦è¾†çŠ¶æ€ï¼š`åœ¨ç§Ÿ` â†’ `åœ¨åº“`
- âœ… è½¦è¾†é‡Œç¨‹ï¼š15230 â†’ 15850 km
- âœ… è½¦è¾†ç”µé‡ï¼š85.5% â†’ 45.2%
- âœ… å‰ç«¯æç¤ºï¼š"è¿˜è½¦ç¡®è®¤æˆåŠŸï¼è½¦è¾†å·²ä¸Šæ¶ã€‚"

---

## ğŸ”— çŠ¶æ€è”åŠ¨å…³ç³»

### è®¢å•çŠ¶æ€ vs è½¦è¾†çŠ¶æ€

| æ“ä½œèŠ‚ç‚¹ | è®¢å•çŠ¶æ€ | è½¦è¾†çŠ¶æ€ | è§¦å‘æ¡ä»¶ |
|---------|---------|---------|---------|
| ç”¨æˆ·ä¸‹å• | `å·²æ”¯ä»˜` | `åœ¨ç§Ÿ` | åˆ›å»ºè®¢å•æ—¶ |
| å‘˜å·¥å–è½¦ç¡®è®¤ | `ä½¿ç”¨ä¸­` | `åœ¨ç§Ÿ` | å¡«å†™å–è½¦ä¿¡æ¯å |
| ç”¨æˆ·è¿˜è½¦ç”³è¯· | `å¾…éªŒè½¦` | `åœ¨ç§Ÿ` | ç”¨æˆ·æäº¤è¿˜è½¦ |
| å‘˜å·¥è¿˜è½¦ç¡®è®¤ | `å·²å®Œæˆ` | `åœ¨åº“` | éªŒè½¦é€šè¿‡å |

### å…³é”®çº¦æŸè§„åˆ™

```sql
-- ä¸šåŠ¡è§„åˆ™ï¼ˆé€šè¿‡åº”ç”¨å±‚æˆ–è§¦å‘å™¨å®ç°ï¼‰

-- 1. åªæœ‰"åœ¨åº“"çš„è½¦è¾†æ‰èƒ½è¢«é¢„è®¢
SELECT * FROM vehicle WHERE status = 0;  -- 0=åœ¨åº“

-- 2. åŒä¸€è¾†è½¦åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ª"ä½¿ç”¨ä¸­"è®¢å•
SELECT COUNT(*) FROM rental_order 
WHERE vehicle_id = ? AND status IN ('å·²æ”¯ä»˜', 'ä½¿ç”¨ä¸­');  -- åº”è¯¥ = 0

-- 3. è¿˜è½¦æ—¶å¿…é¡»éªŒè¯é‡Œç¨‹é€’å¢
-- return_mileage >= pickup_mileage

-- 4. è®¢å•å®Œæˆåè½¦è¾†å¿…é¡»å›åˆ°"åœ¨åº“"çŠ¶æ€
-- é˜²æ­¢è½¦è¾†è¢«æ°¸ä¹…é”å®š
```

---

## ğŸ› ï¸ æŠ€æœ¯å®ç°è¦ç‚¹

### åç«¯ API è®¾è®¡

```java
// 1. ç”¨æˆ·ä¸‹å•
POST /api/orders
Body: { customerId, vehicleId, rentStart, rentEnd, ... }
Response: { orderId, status: "å·²æ”¯ä»˜" }

// 2. æŸ¥è¯¢è®¢å•åˆ—è¡¨ï¼ˆæ”¯æŒçŠ¶æ€ç­›é€‰ï¼‰
GET /api/orders?status=å·²æ”¯ä»˜
Response: [ { orderId, customerName, vehicleName, ... } ]

// 3. å‘˜å·¥ç¡®è®¤å–è½¦
PUT /api/orders/{orderId}/pickup
Body: { actualPickupTime, pickupMileage, pickupSoc, remarks }
Response: { success: true, message: "å–è½¦ç¡®è®¤æˆåŠŸ" }

// 4. ç”¨æˆ·ç”³è¯·è¿˜è½¦
PUT /api/orders/{orderId}/apply-return
Response: { success: true, message: "è¿˜è½¦ç”³è¯·å·²æäº¤" }

// 5. å‘˜å·¥ç¡®è®¤è¿˜è½¦
PUT /api/orders/{orderId}/confirm-return
Body: { actualReturnTime, returnMileage, returnSoc, remarks }
Response: { success: true, message: "è¿˜è½¦ç¡®è®¤æˆåŠŸ" }
```

### å‰ç«¯äº¤äº’æµç¨‹

**ç”¨æˆ·ä¾§ï¼ˆcustomer.htmlï¼‰ï¼š**
```javascript
// ä¸‹å•æµç¨‹
1. é€‰æ‹©è½¦è¾† â†’ openBooking(vehicle)
2. å¡«å†™è¡¨å• â†’ submitBooking()
3. POST /api/orders
4. åˆ·æ–°è½¦è¾†åˆ—è¡¨ï¼ˆå·²é¢„è®¢è½¦è¾†æ¶ˆå¤±ï¼‰

// è¿˜è½¦æµç¨‹
1. æŸ¥çœ‹è®¢å• â†’ fetchMyOrders()
2. ç‚¹å‡»"ç”³è¯·è¿˜è½¦" â†’ applyReturn(orderId)
3. PUT /api/orders/{id}/apply-return
4. è®¢å•çŠ¶æ€æ˜¾ç¤ºä¸º"å¾…éªŒè½¦"
```

**å‘˜å·¥ä¾§ï¼ˆindex.htmlï¼‰ï¼š**
```javascript
// å–è½¦ç¡®è®¤æµç¨‹
1. æŸ¥çœ‹å¾…å–è½¦è®¢å• â†’ fetchOrders({ status: 'å·²æ”¯ä»˜' })
2. ç‚¹å‡»"ç¡®è®¤å–è½¦" â†’ openPickupDialog(order)
3. å¡«å†™å–è½¦è¡¨å• â†’ submitPickup()
4. PUT /api/orders/{id}/pickup
5. åˆ·æ–°è®¢å•åˆ—è¡¨

// è¿˜è½¦ç¡®è®¤æµç¨‹
1. æŸ¥çœ‹å¾…éªŒè½¦è®¢å• â†’ fetchOrders({ status: 'å¾…éªŒè½¦' })
2. ç‚¹å‡»"éªŒè½¦è¿˜è½¦" â†’ openReturnDialog(order)
3. å¡«å†™è¿˜è½¦è¡¨å•ï¼ˆå¯¹æ¯”å–è½¦æ•°æ®ï¼‰â†’ submitReturn()
4. PUT /api/orders/{id}/confirm-return
5. åˆ·æ–°è®¢å•åˆ—è¡¨å’Œè½¦è¾†åˆ—è¡¨
```

---

## ğŸ“ˆ æ•°æ®æµè½¬ç¤ºä¾‹

### å®Œæ•´çš„æ•°æ®å˜åŒ–è¿‡ç¨‹

**åˆå§‹çŠ¶æ€ï¼š**
```sql
-- è½¦è¾† ID=1
vehicle: { plate_no: 'äº¬A12345', status: 0, mileage: 15230, soc: 85.5 }
```

**Step 1ï¼šç”¨æˆ·ä¸‹å•**
```sql
-- æ–°å¢è®¢å•
rental_order: {
    order_id: 16,
    customer_id: 1,
    vehicle_id: 1,
    status: 'å·²æ”¯ä»˜',
    rent_start: '2025-12-10 09:00:00',
    rent_end: '2025-12-13 18:00:00',
    total_amount: 1200.00
}

-- è½¦è¾†çŠ¶æ€å˜åŒ–
vehicle: { ..., status: 1 }  -- åœ¨ç§Ÿ
```

**Step 2ï¼šå‘˜å·¥ç¡®è®¤å–è½¦**
```sql
-- è®¢å•æ›´æ–°
rental_order: {
    ...,
    status: 'ä½¿ç”¨ä¸­',
    actual_pickup_time: '2025-12-10 09:15:00',
    pickup_mileage: 15230,
    pickup_soc: 85.5
}
```

**Step 3ï¼šç”¨æˆ·ç”³è¯·è¿˜è½¦**
```sql
-- è®¢å•æ›´æ–°
rental_order: { ..., status: 'å¾…éªŒè½¦' }
```

**Step 4ï¼šå‘˜å·¥ç¡®è®¤è¿˜è½¦**
```sql
-- è®¢å•å®Œæˆ
rental_order: {
    ...,
    status: 'å·²å®Œæˆ',
    actual_return_time: '2025-12-13 17:30:00',
    return_mileage: 15850,
    return_soc: 45.2
}

-- è½¦è¾†é‡Šæ”¾
vehicle: {
    plate_no: 'äº¬A12345',
    status: 0,              -- åœ¨åº“
    mileage: 15850,         -- æ›´æ–°
    soc: 45.2               -- æ›´æ–°
}
```

---

## âœ… è¯¾ç¨‹è®¾è®¡éªŒæ”¶è¦ç‚¹

### å±•ç¤ºå†…å®¹

**1. æ•°æ®åº“è®¾è®¡**
- âœ… å®Œæ•´çš„ERå›¾ï¼ˆè®¢å•ã€è½¦è¾†ã€å®¢æˆ·å…³è”ï¼‰
- âœ… åˆç†çš„å­—æ®µè®¾è®¡ï¼ˆçŠ¶æ€æšä¸¾ã€æ—¶é—´æˆ³ã€é‡Œç¨‹è®°å½•ï¼‰
- âœ… å¤–é”®çº¦æŸå’Œç´¢å¼•

**2. ä¸šåŠ¡é€»è¾‘**
- âœ… æ¸…æ™°çš„çŠ¶æ€æµè½¬å›¾
- âœ… è®¢å•ä¸è½¦è¾†çš„çŠ¶æ€è”åŠ¨
- âœ… æ•°æ®ä¸€è‡´æ€§ä¿è¯

**3. åŠŸèƒ½æ¼”ç¤º**
- âœ… ç”¨æˆ·ç«¯ï¼šæµè§ˆè½¦è¾† â†’ ä¸‹å• â†’ æŸ¥çœ‹è®¢å• â†’ ç”³è¯·è¿˜è½¦
- âœ… å‘˜å·¥ç«¯ï¼šç¡®è®¤å–è½¦ â†’ ç›‘æ§è®¢å• â†’ éªŒè½¦è¿˜è½¦
- âœ… æ•°æ®åº“ï¼šå®æ—¶æŸ¥çœ‹æ•°æ®å˜åŒ–

**4. SQL æŸ¥è¯¢èƒ½åŠ›**
```sql
-- æŸ¥è¯¢æ‰€æœ‰å¾…å–è½¦è®¢å•
SELECT o.*, c.name, v.plate_no, m.name AS model_name
FROM rental_order o
JOIN customer c ON o.customer_id = c.customer_id
JOIN vehicle v ON o.vehicle_id = v.vehicle_id
JOIN car_model m ON v.model_id = m.model_id
WHERE o.status = 'å·²æ”¯ä»˜'
ORDER BY o.rent_start;

-- æŸ¥è¯¢è½¦è¾†åˆ©ç”¨ç‡
SELECT 
    v.plate_no,
    COUNT(o.order_id) AS order_count,
    SUM(DATEDIFF(o.rent_end, o.rent_start)) AS total_days
FROM vehicle v
LEFT JOIN rental_order o ON v.vehicle_id = o.vehicle_id
WHERE o.status = 'å·²å®Œæˆ'
GROUP BY v.vehicle_id
ORDER BY total_days DESC;

-- æŸ¥è¯¢è¶…æœŸæœªè¿˜è½¦è®¢å•
SELECT * FROM rental_order
WHERE status = 'ä½¿ç”¨ä¸­' 
  AND rent_end < NOW();
```

---

## ğŸ“ è¯¾ç¨‹è®¾è®¡æ€»ç»“

### æ ¸å¿ƒä»·å€¼

è¿™ä¸ªç®€åŒ–çš„é—­ç¯è®¾è®¡ï¼š

1. **è´´è¿‘å®é™…ä¸šåŠ¡**ï¼šå®Œæ•´è¦†ç›–ç§Ÿè½¦è¡Œä¸šçš„æ ¸å¿ƒæµç¨‹
2. **æ•°æ®åº“è®¾è®¡åˆç†**ï¼šåˆ©ç”¨ç°æœ‰è¡¨ç»“æ„ï¼Œæœ€å°åŒ–æ”¹åŠ¨
3. **å¼€å‘éš¾åº¦é€‚ä¸­**ï¼š3ä¸ªæ–°æ¥å£ + 2ä¸ªå‰ç«¯é¡µé¢
4. **æ¼”ç¤ºæ•ˆæœæ¸…æ™°**ï¼š4æ­¥æµç¨‹ï¼Œæ•°æ®å˜åŒ–å¯è§†åŒ–

### æ‰©å±•æ–¹å‘ï¼ˆå¯é€‰ï¼‰

å¦‚æœæ—¶é—´å……è£•ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹æ‰©å±•ï¼š

- **æ”¯ä»˜é›†æˆ**ï¼šæ¨¡æ‹ŸæŠ¼é‡‘å†»ç»“å’Œé€€è¿˜
- **è¶…æ—¶å¤„ç†**ï¼šå®šæ—¶ä»»åŠ¡æ£€æŸ¥è¶…æœŸè®¢å•
- **æŸåèµ”å¿**ï¼šè¿˜è½¦æ—¶è®°å½•æŸåå¹¶è®¡ç®—èµ”å¿è´¹ç”¨
- **è¯„ä»·ç³»ç»Ÿ**ï¼šç”¨æˆ·å®Œæˆè®¢å•åè¯„ä»·è½¦è¾†å’ŒæœåŠ¡
- **æ•°æ®ç»Ÿè®¡**ï¼šè®¢å•é‡ã€æ”¶å…¥ã€è½¦è¾†åˆ©ç”¨ç‡ç­‰æŠ¥è¡¨

---

## ğŸ“š å‚è€ƒèµ„æ–™

- **å¸‚åœºæ¡ˆä¾‹**ï¼šç¥å·ç§Ÿè½¦ã€ä¸€å—¨ç§Ÿè½¦ã€Turo
- **æŠ€æœ¯æ ˆ**ï¼šSpring Boot + JPA + MySQL + Vue.js
- **è®¾è®¡æ¨¡å¼**ï¼šçŠ¶æ€æœºæ¨¡å¼ï¼ˆè®¢å•çŠ¶æ€æµè½¬ï¼‰

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0  
**æœ€åæ›´æ–°ï¼š** 2025-12-09  
**ä½œè€…ï¼š** Tesla ç§Ÿè½¦ç³»ç»Ÿå¼€å‘ç»„
